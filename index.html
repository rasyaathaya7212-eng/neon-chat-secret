<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeonNexus</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script>
        // Global Error Handler for debugging
        window.onerror = function(msg, url, line, col, error) {
            console.error("Global Error:", msg, error);
        };
        
        document.addEventListener('DOMContentLoaded', () => {
            if (window.location.protocol === 'file:') {
                const app = document.getElementById('app');
                app.innerHTML = `
                    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background:#050505;color:#ff3333;font-family:sans-serif;text-align:center;padding:20px;">
                        <h1 style="font-size:2rem;margin-bottom:20px;">⚠️ SETUP REQUIRED ⚠️</h1>
                        <p style="font-size:1.2rem;max-width:600px;line-height:1.6;color:#fff;">
                            You are running this file directly (file://).<br>
                            Browser security blocks this app from connecting to the database in this mode.
                        </p>
                        <div style="background:#1a1a1a;padding:20px;border-radius:10px;margin-top:30px;border:1px solid #00f3ff;text-align:left;">
                            <h3 style="color:#00f3ff;margin-top:0;">How to fix:</h3>
                            <ol style="color:#ccc;margin-left:20px;">
                                <li style="margin-bottom:10px;">Open this folder in <strong>VS Code</strong>.</li>
                                <li style="margin-bottom:10px;">Install the <strong>"Live Server"</strong> extension.</li>
                                <li style="margin-bottom:10px;">Right-click <strong>index.html</strong>.</li>
                                <li>Select <strong>"Open with Live Server"</strong>.</li>
                            </ol>
                        </div>
                    </div>
                `;
            }
        });
    </script>
</head>
<body>
    <div id="app">
        <div class="scanline"></div>
        
        <!-- Login Screen -->
        <section id="login-screen" class="screen active">
            <div class="neon-panel">
                <h1 class="glitch" data-text="NeonNexus">NeonNexus</h1>
                <div class="auth-forms">
                    <form id="login-form">
                        <h2>Login</h2>
                        <input type="email" id="login-email" placeholder="Email" required>
                        <input type="password" id="login-password" placeholder="Password" required>
                        <button type="submit" class="neon-btn">Enter The Nexus</button>
                    </form>
                    <div class="divider">OR</div>
                    <form id="signup-form">
                        <h2>Sign Up</h2>
                        <input type="email" id="signup-email" placeholder="Email" required>
                        <input type="password" id="signup-password" placeholder="Password" required>
                        <button type="submit" class="neon-btn secondary">Initialize ID</button>
                    </form>
                </div>
                <div id="auth-error" class="error-msg hidden"></div>
            </div>
        </section>

        <!-- Room Selection Screen -->
        <section id="room-screen" class="screen hidden">
            <div class="neon-panel">
                <h2>Welcome, <span id="user-display-name">User</span></h2>
                <div class="room-controls">
                    <div class="control-group">
                        <h3>Create Room</h3>
                        <input type="text" id="new-room-name" placeholder="Room Name (Optional)">
                        <input type="password" id="new-room-password" placeholder="Password (Optional)">
                        <button id="create-room-btn" class="neon-btn">Create & Join</button>
                    </div>
                    <div class="divider">OR</div>
                    <div class="control-group">
                        <h3>Join Room</h3>
                        <input type="text" id="room-code-input" placeholder="Room Code" maxlength="5">
                        <input type="password" id="join-room-password" placeholder="Password (If required)">
                        <button id="join-room-btn" class="neon-btn secondary">Connect</button>
                    </div>
                </div>
                <button id="logout-btn" class="neon-btn danger">Disconnect</button>
            </div>
        </section>

        <!-- Chat Screen -->
        <section id="chat-screen" class="screen hidden">
            <header class="chat-header">
                <div class="room-info">
                    <span class="label">Room:</span>
                    <span id="current-room-code" class="code">-----</span>
                </div>
                <button id="leave-room-btn" class="neon-btn small">Leave</button>
                <div class="call-actions" style="display:flex; gap:10px; margin-left:10px;">
                    <button id="video-call-btn" class="icon-btn" title="Video Call">
                        <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/></svg>
                    </button>
                    <button id="voice-call-btn" class="icon-btn" title="Voice Call">
                        <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 1.23 1.23 1.43 2.45 1.8 3.57.12.35.03.76-.24 1.02l-2.2 2.2z"/></svg>
                    </button>
                </div>
            </header>
            
            <div id="chat-messages" class="chat-messages">
                <!-- Messages will appear here -->
            </div>

            <div class="chat-input-area">
                <button id="image-btn" class="icon-btn" title="Send Image">
                    <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                </button>
                <input type="file" id="image-input" accept="image/*" hidden>
                
                <button id="mic-btn" class="icon-btn" title="Record Voice">
                    <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path fill="currentColor" d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
                </button>
                
                <form id="message-form">
                    <input type="text" id="message-input" placeholder="Transmitting data..." required autocomplete="off">
                    <button type="submit" class="neon-btn send-btn">Send</button>
                </form>
            </div>
            
            <div id="recording-overlay" class="hidden">
                <div class="recording-status">
                    <div class="pulse"></div>
                    <span>Recording...</span>
                </div>
                <div class="recording-controls">
                    <button id="cancel-recording-btn" class="neon-btn danger">Cancel</button>
                    <button id="send-recording-btn" class="neon-btn success">Send</button>
                </div>
            </div>

            <div id="call-overlay" class="hidden">
                <div class="video-grid">
                    <video id="remote-video" autoplay playsinline></video>
                    <video id="local-video" autoplay playsinline muted></video>
                </div>
                <div class="call-controls-bar">
                    <button id="hangup-btn" class="neon-btn danger">End Call</button>
                </div>
            </div>
        </section>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/ui.js"></script>
    <script type="module" src="js/auth.js"></script>
    <script type="module" src="js/call.js"></script>
    <script type="module" src="js/chat.js"></script>
</body>
</html>